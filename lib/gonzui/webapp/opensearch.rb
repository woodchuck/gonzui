#
# opensearch.rb - opensearch plugin
#
# You can redistribute it and/or modify it under the terms of 
# the GNU General Public License version 2.
#

module Gonzui
  class OpensearchServlet < GonzuiAbstractServlet
    def self.mount_point
      "opensearch"
    end

    def do_GET(request, response)
      response.status = 200
      response['Content-Type'] = "application/opensearchdescription+xml"
      response.body = '
<OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"
                       xmlns:moz="http://www.mozilla.org/2006/browser/search/">
<ShortName>Gonzui</ShortName>
<Description>SHA Gonzui source code search</Description>
<InputEncoding>UTF-8</InputEncoding>
<Image width="16" height="16">data:image/x-ico;base64,AAABAAIAEBAAAAAAAABoBQAAJgAAACAgAAAAAAAAqAgAAI4FAAAoAAAAEAAAACAAAAABAAgAAAAAAEABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP%2F%2F%2FwCIiIgAxMTEAKampgDi4uIA09PTAJeXlwC2trYA8vLyAOvr6wCPj48A29vbAMzMzACvr68Avb29APr6%2BgCcnJwA5%2BfnAJOTkwCioqIAqqqqAO%2Fv7wCLi4sA39%2FfANbW1gCzs7MAwMDAALm5uQD9%2Ff0A9PT0AI2NjQDt7e0AkZGRAOnp6QCVlZUA5eXlAJmZmQCkpKQA0dHRAMrKygC7u7sA%2Fv7%2BAPz8%2FAD7%2B%2FsAjIyMAI6OjgCQkJAAkpKSAOjo6ACUlJQA5ubmAJaWlgDk5OQAmJiYAJubmwCnp6cAq6urAM3NzQDLy8sAtLS0ALe3twC4uLgAvr6%2BALy8vAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBAQEBAQEBAQEBAQEBAQEBAQ09OQQVPhkrAQEBAQEBAQERAgICAgICNhIBAQEBAQEBGjcpKAMEAgIhCQEBAQEBASwBAQEBARwCAj4BAQEBAQEBIDkuFxQoAgILHQEBAQEBKzQCAgICAgICAjMBAQEBAQUCAgIbGA00AgIoAQEBAQEMAgIwAQEBOgICDgEBAQEBJAICLwEBATECAhMBAQEBASwtAgIiAQEdHwICFgEBAQEBCAICJhABATgCAgYBAQEBAR4yAgIHD0AjAgI%2BAQEBAQEBCiUCAgICAgICEQEBAQEBAQEsJzwOPzU7Ow0qAQEBAQEBAQEBAQEBAQEBAQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAIAAAAAACABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD%2F%2F%2F8AiIiIAMTExADh4eEAp6enAJeXlwDv7%2B8A09PTALa2tgD4%2BPgAkJCQANra2gCenp4A6enpAM3NzQCtra0Avr6%2BAIyMjACioqIAycnJAPz8%2FAD19fUA8vLyAOzs7ACUlJQA5ubmAJqamgDe3t4AqqqqANDQ0ACzs7MAubm5AMHBwQD6%2BvoAioqKAI6OjgCSkpIA5OTkANzc3ACkpKQA2NjYAMfHxwC7u7sA%2Fv7%2BAP39%2FQD7%2B%2FsAiYmJAPn5%2BQCLi4sA9vb2AI2NjQCRkZEA7u7uAJWVlQCWlpYA6%2BvrAOrq6gCYmJgAmZmZAOfn5wCdnZ0A4%2BPjAKGhoQCjo6MA2dnZAKioqACpqakA1NTUAKysrADR0dEAz8%2FPAM7OzgC0tLQAtbW1AMjIyAC4uLgAxcXFAMPDwwC%2Fv78AwMDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEtNRxGFE0DSx4cFwEBAQEBAQEBAQEBAQEBAQEBAQEBBRICAgICAgICAgICOyEXAQEBAQEBAQEBAQEBAQEBAQEoAgICAgICAgICAgICAhIDLQEBAQEBAQEBAQEBAQEBASsCAgICAgICAgICAgICAgJCIgEBAQEBAQEBAQEBAQEBCAICAgIvJTcLAgICAgICAgJFLAEBAQEBAQEBAQEBAQE4AhshBDABAQEKJx0CAgICAgIPAQEBAQEBAQEBAQEBASwXAQEBAQEBAQEBASECAgICAgswAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBLA0CAgICAg8BAQEBAQEBAQEBAQEBAQEBJgkbEi8lQ0YuRwICAgICEwEBAQEBAQEBAQEBAQEBLUwCAgICAgICAjYqAgICAgIvMgEBAQEBAQEBAQEBAQERAgICAgICAgICAgICAgICAgIMAQEBAQEBAQEBAQEBFyMCAgICAgICAgICAgICAgICAhEBAQEBAQEBAQEBAQFIAgICAgICL0JPIRASAgICAgICQAEBAQEBAQEBAQEBASsCAgICAgJGAQEBATJQAgICAgIxLgEBAQEBAQEBAQEBCQICAgICGSwBAQEBAS0kAgICAgI%2BAQEBAQEBAQEBAQEgAgICAgIoAQEBAQEBAUICAgICAioBAQEBAQEBAQEBAU4CAgICAj8BAQEBAQEBTgICAgICRQEBAQEBAQEBAQEBRAICAgICNAEBAQEBAQEcAgICAgI0LAEBAQEBAQEBAQE1AgICAgICOQEBAQEBAQovAgICAgIYAQEBAQEBAQEBAQEbAgICAgIrAQEBAQEBAT0CAgICAh4BAQEBAQEBAQEBAUsCAgICAjEOAQEBAQEBTAICAgICSgEBAQEBAQEBAQEBMDQCAgICAjcYAQEBAQEIAgICAgI7AQEBAQEBAQEBAQEBRAICAgICAjMhDi4iGisCAgICAgIWAQEBAQEBAQEBAQEBTAICAgICAgICAgICAgICAgICAkEBAQEBAQEBAQEBAQEsHwICAgICAgICAgICAgICAgICEQEBAQEBAQEBAQEBAQEBSzECAgICAgICAgICAgICAgITAQEBAQEBAQEBAQEBAQEBB0wLAgICAgIkSRw6BgYGBhstAQEBAQEBAQEBAQEBAQEBAS0OQQgpPBUBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA%3D</Image>
<Url type="text/html" method="GET" template="http://gonzui.sha.cornell.edu/search?q={searchTerms}&amp;n=50&amp;fm=all" />
<moz:SearchForm>http://gonzui.sha.cornell.edu/</moz:SearchForm>
</OpenSearchDescription>
      '
    end

    GonzuiServlet.register(self)
  end
end
